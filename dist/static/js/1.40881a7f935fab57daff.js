webpackJsonp([1],{"0gg5":function(e,t){},"4cOk":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("woOf"),n=i.n(r),a=i("mvHQ"),l=i.n(a),s=window.XLSX,o={name:"Excel",data:function(){return{isUp:!1,colors:["#7A24A6","#001E64","#0070C6","#00B2F6","#00B441","#7ED432","#FEFF00","#FFBE00","#FF0000","#D20000"],suffix:"xlsx",fileName:"",startTime:"",remarks:[],fields:[],timelines:[],curTimelines:[],planTimeLines:[],table:[],devInfo:{}}},computed:{info:function(){var e=0,t=0,i=[];for(var r in this.devInfo)e+=this.devInfo[r].开发总天数||0,t+=this.devInfo[r].延期总天数||0,i.push(r+'<span style="color:#ff0000;">'+this.devInfo[r].开发总天数+"天</span>");return{total:e,delay:t,devs:i.toString()}},endDate:function(){var e=this.timelines.length?this.timelines[this.timelines.length-1]:{},t=0;for(var i in this.devInfo)for(var r=0;r<this.devInfo[i].devlog.length;r++)t=Math.max(t,this.devInfo[i].devlog[r]);for(var n=0,a=0;a<this.table.length;a++)100==this.table[a].进度&&n++;return{date:n==this.table.length?new Date(t).format("MM月dd日"):e.date,time:n==this.table.length?t:e.time}}},methods:{getTimeLines:function(e,t,i){for(var r=[],n=0,a=0;a<Math.ceil(e)||n<=t;){var l=Date.parse(i)+864e5*n,s=new Date(l),o=0!=s.getDay()&&6!=s.getDay(),h={date:s.format("MM月dd日"),mark:o?0:1,time:l};r.push(h),n++,o&&a<Math.ceil(e)&&a++}return r},colorRgb:function(e,t){var i=e.toLowerCase();if(i&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(i)){if(4===i.length){for(var r="#",n=1;n<4;n+=1)r+=i.slice(n,n+1).concat(i.slice(n,n+1));i=r}for(var a=[],l=1;l<7;l+=2)a.push(parseInt("0x"+i.slice(l,l+2)));i="rgba("+a.join(",")+","+(void 0!=t?t:.3)+")"}var s=i.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),o=parseFloat(s[3]||1),h=Math.floor(o*parseInt(s[0])+255*(1-o)),f=Math.floor(o*parseInt(s[1])+255*(1-o)),g=Math.floor(o*parseInt(s[2])+255*(1-o));return"#"+("0"+h.toString(16)).slice(-2)+("0"+f.toString(16)).slice(-2)+("0"+g.toString(16)).slice(-2)},getCellStyle:function(e){var t="";if(e.columnIndex>this.fields.length-1&&""!=e.row.开发人员){var i=e.row.timelines[e.columnIndex-this.fields.length];t=2==i?"background-color:"+e.row.color:3==i?"background-color:"+this.colorRgb(e.row.color):4==i?"background-color:"+this.colorRgb(e.row.color,.7):5==i?"color:#FF0000;":""}return t},sheetFmt:function(e){if(e.length){for(var t=[],i=0;i<e[0].length&&(t.push(e[0][i]),"进度"!=e[0][i]);i++);this.fields=t;for(var r=[],n=e.length,a=0;a<e.length;a++){if(""===e[a].join("").toString().trim()){n=a+1;break}r.push(e[a])}for(var l=[],s=n;s<e.length;s++){if(""===e[s].join("").toString().trim()){n=s+1;break}l.push(e[s].join("").toString().trim())}this.remarks=l;for(var o=[],h=1;h<r.length;h++){for(var f={},g=0;g<Math.max(r[h].length,this.fields.length);g++)g<this.fields.length&&(f[this.fields[g]]=r[h][g]||"");o.push(f)}for(var c={},v=0;v<o.length;v++){var m=c[o[v].开发人员||"开发人员"]||{};m.开发记录=(m.开发记录||"")+o[v].开发记录,m.休假记录=(m.休假记录||"")+o[v].休假记录,c[o[v].开发人员||"开发人员"]=m}var d=0;for(var p in c){c[p].color=this.colors[Math.floor(d%this.colors.length)],d++;var u=c[p].开发记录.split("#");u=u.splice(1,u.length),c[p].devlog=[];for(var b=0;b<u.length;b++)c[p].devlog.push(Date.parse(u[b]))}for(var _=0;_<o.length;_++){var y=o[_].开发记录.split("#");y=y.splice(1,y.length),o[_].devlog=[];for(var C=0,A=0;A<y.length;A++){var x=0,F=Date.parse(y[A]);o[_].devlog.push(F);for(var w=0;w<c[o[_].开发人员||"开发人员"].devlog.length;w++)F==c[o[_].开发人员||"开发人员"].devlog[w]&&x++;x>0&&(C+=Math.floor(100/x))}var T=100*parseFloat(o[_].评估天数||0);o[_].延期天数=C>T?(C-T)/100:C==T&&100!=o[_].进度?.5:""}for(var k=0;k<o.length;k++){var S=c[o[k].开发人员||"开发人员"]||{};o[k].color=S.color,S.开发总天数=parseFloat(S.开发总天数||0),S.延期总天数=parseFloat(S.延期总天数||0),o[k].min=parseInt(S.开发总天数),S.开发总天数+=parseFloat(o[k].评估天数||0)+parseFloat(o[k].延期天数||0),S.延期总天数+=parseFloat(o[k].延期天数||0),o[k].max=Math.ceil(S.开发总天数),c[o[k].开发人员||"开发人员"]=S}for(var M in c){var E=c[M].休假记录.split("#");E=E.splice(1,E.length);for(var B=[],D=0;D<E.length;D++)if(0==D)B.push(Date.parse(E[D]));else{for(var L=0,I=0;I<B.length;I++)if(B[D]==E[I]){L++;break}0==L&&B.push(Date.parse(E[D]))}c[M].happyTime=B}var N=0,U=0;for(var O in c){N=Math.max(N,c[O].开发总天数+c[O].happyTime.length);for(var R=0;R<c[O].devlog.length;R++)U=Math.max(U,c[O].devlog[R])}for(var j=(U-Date.parse(this.startTime))/864e5,$=this.getTimeLines(N,j,this.startTime),W=0;W<o.length;W++){o[W].timelines=[];for(var X=0,z=0;z<$.length;z++){var H=0;if(X>=o[W].min&&X<o[W].max&&1!=$[z].mark){for(var J=c[o[W].开发人员||"开发人员"].happyTime,K=0;K<J.length;K++)$[z].time==J[K]&&H++;H>0?o[W].timelines.push(5):o[W].timelines.push(2)}else 1==$[z].mark?o[W].timelines.push(1):o[W].timelines.push(0);1!=$[z].mark&&0==H&&X++;for(var P=0;P<o[W].devlog.length;P++)if(o[W].devlog[P]==$[z].time){o[W].timelines[o[W].timelines.length-1]=2==o[W].timelines[o[W].timelines.length-1]?4:3;break}}}for(var q=0;q<o.length;q++){var G=c[o[q].开发人员||"开发人员"];if(G.剩余天数=G.剩余天数||0,100!=o[q].进度)if((o[q].延期天数||0)>0)G.剩余天数+=1;else{for(var Q=0,V=0;V<o[q].devlog.length;V++){for(var Y=0,Z=0;Z<G.devlog.length;Z++)o[q].devlog[V]==G.devlog[Z]&&Y++;Y>0&&(Q+=Math.floor(1e3/Y))}G.剩余天数+=100!=o[q].进度?(o[q].评估天数||0)-Q/1e3:0}}var ee=0,te=(new Date).format("yyyy/MM/dd"),ie=Date.parse(te);for(var re in c){for(var ne=0,ae=0;ae<c[re].happyTime.length;ae++)c[re].happyTime[ae]>ie&&ne++;for(var le=0,se=0;se<o.length;se++)o[se].开发人员==re&&100!=o[se].进度&&le++;ee=Math.max(c[re].剩余天数+(le>0?ne:0),ee)}var oe=ee>0?this.getTimeLines(ee,0,new Date(ie+864e5).format("yyyy/MM/dd")):[];for(var he in N=0,c)N=Math.max(N,c[he].开发总天数-c[he].延期总天数+c[he].happyTime.length);var fe=this.getTimeLines(N,0,this.startTime);this.planTimeLines=fe,this.devInfo=c,this.curTimelines=oe,this.timelines=$,this.table=o,console.log(o),console.log(c)}},onchange:function(e){var t=this,i=e.target.files;if(i&&0!=i.length){t.isUp=!0;var r=i[0];t.fileName=r.name.replace("."+t.suffix,"").split(" ")[0],t.startTime=t.fileName.split("_")[1].replace(/\-/g,"/"),console.log(t.startTime);var n=new FileReader;n.onload=function(e){for(var i="",r=new Uint8Array(e.target.result),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);var o=s.read(i,{type:"binary"}),h=o.SheetNames[0],f=o.Sheets[h],g=s.utils.sheet_to_json(f,{header:1});console.log(l()(g).replace(/\"/g,"'")),t.sheetFmt(g)},n.readAsArrayBuffer(r)}},getCharCol:function(e){for(var t="",i=0;e>0;)i=e%26+1,t=String.fromCharCode(i+64)+t,e=(e-i)/26;return t},s2ab:function(e){if("undefined"!=typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),r=0;r!=e.length;++r)i[r]=255&e.charCodeAt(r);return t}for(var n=new Array(e.length),a=0;a!=e.length;++a)n[a]=255&e.charCodeAt(a);return n},sheetStyle:function(e,t,i){var r={v:e=i||e.toString(),t:isNaN(Number(e))||""===e.trim()?-1!=e.indexOf("月")&&-1!=e.indexOf("日")&&e.length==e.indexOf("日")+1?"n":"s":"n"};return t&&(r.s={fill:{fgColor:{rgb:t.replace("#","")}}}),i&&(r.s=r.s||{},r.s.font={sz:12,bold:!1,color:{rgb:"FF0000"}},r.s.alignment={vertical:"center",horizontal:"center"}),r},saveAs:function(e){var t=document.createElement("a");t.download=this.fileName+"."+this.suffix,"msSaveOrOpenBlob"in navigator?window.navigator.msSaveOrOpenBlob(e,t.download):t.href=URL.createObjectURL(e),t.click(),setTimeout(function(){URL.revokeObjectURL(e)},100)},downloadExl:function(){for(var e=[],t=this.fields.map(function(e){return{name:e,value:0}}).concat(this.isUp?this.timelines.map(function(e){return{name:e.date,value:e.mark}}):[]),i={},r="A1",a=0;a<t.length;a++){var l=a>25?this.getCharCol(a):String.fromCharCode(65+a);i[l+1]=this.sheetStyle(t[a].name,1==t[a].value?"#CCCCCC":""),i[l+(this.table.length+2)]=this.sheetStyle("","#000000"),r=l+(this.table.length+2);for(var o=0;o<this.remarks.length;o++)i[l+(this.table.length+3+o)]=this.sheetStyle(0==a?this.remarks[o].trim():""),r=l+(this.table.length+3+o),0==a&&e.push({s:{c:0,r:this.table.length+3+o-1},e:{c:this.fields.length-1,r:this.table.length+3+o-1}})}for(var h=0;h<this.table.length;h++)for(var f=0;f<t.length;f++){var g=f>25?this.getCharCol(f):String.fromCharCode(65+f);if(f<this.fields.length)i[g+(h+2)]=this.sheetStyle(this.table[h][this.fields[f]]);else{var c=this.table[h].timelines[f-this.fields.length],v="",m="";""!=this.table[h].开发人员&&2==c?v=this.table[h].color:1==c?v="#CCCCCC":3==c?v=this.colorRgb(this.table[h].color):4==c?v=this.colorRgb(this.table[h].color,.7):5==c?m="休息":v="",i[g+(h+2)]=this.sheetStyle("",v,m)}}i["!merges"]=e;var d={SheetNames:["排期"],Sheets:{"排期":n()({},i,{"!ref":"A1:"+r})}};this.isUp&&(d.SheetNames.push("项目信息"),d.Sheets.项目信息={"!ref":"A1:A3",A1:{v:this.$refs.info1.innerText,t:"s"},A2:{v:this.$refs.info2.innerText,t:"s"},A3:{v:this.$refs.info3.innerText,t:"s"}}),console.log(d);var p=new Blob([this.s2ab(s.write(d,{bookType:this.suffix,bookSST:!1,type:"binary"}))],{type:""});this.saveAs(p)}},mounted:function(){this.fileName="排期示例_"+(new Date).format(),this.startTime=this.fileName.split("_")[1].replace(/\-/g,"/");this.sheetFmt([["自定义一级页面","自定义二级页面","自定义三级页面","开发人员","评估天数","休假记录","延期天数","开发记录","进度"],["首页","","banner","路人甲","2.5","","","",""],["新闻","新闻列表","","路人乙","1.5","","","",""],["","","新闻详情","路人甲","1.5","","","",""],["","","","","","","","",""],["黑色条是一个分界线，每天站会纪要问题可以写在黑色条下面，方便项目跟踪","","","","","","","",""],["自定义的东西可以随便添加N个","","","","","","","",""],["休假记录和开发记录的日期必须#符号开头，如#2019/1/1或#2019/01/01","","","","","","","",""],["但是自定义后面的[开发人员,评估天数,休假记录,延期天数,开发记录,进度]为固定内容","","","","","","","",""],["休假记录：把你休息的那天日期记录起来，就不会排期了","","","","","","","",""],["延期天数：导入到网站保存的时候，会自动结算(开发记录大于评估天数=延期1天，相等并进度不等于100=延期0.5天)","","","","","","","",""],["干活前：你只需要弄自定义页面，开发人员，评估天数","","","","","","","",""],["干活后：你只需要填开发记录，进度","","","","","","","",""]]),this.$api.postJson("/a.gif",function(e){console.log(e)},{s:"%7B%22seq%22%3A1%2C%22project%22%3A%22baodao_h5%22%2C%22version%22%3A%221.0.0%22%2C%22distinct_id%22%3A%22%22%2C%22time%22%3A1555308435927%2C%22event%22%3A%22webclick%22%2C%22properties%22%3A%7B%22is_login_id%22%3Atrue%2C%22ip%22%3A%22180.167.229.162%22%2C%22province%22%3A%22%E4%B8%8A%E6%B5%B7%E5%B8%82%22%2C%22city%22%3A%22%E4%B8%8A%E6%B5%B7%E5%B8%82%22%2C%22user_agent%22%3A%22Mozilla%2F5.0%20(Windows%20NT%2010.0%3B%20WOW64)%20AppleWebKit%2F537.36%20(KHTML%2C%20like%20Gecko)%20Chrome%2F73.0.3683.86%20Safari%2F537.36%22%2C%22screen_width%22%3A1920%2C%22screen_height%22%3A1080%2C%22title%22%3A%22%E5%9F%8B%E7%82%B9%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2%22%2C%22url%22%3A%22file%3A%2F%2F%2FC%3A%2FUsers%2Fthink%2FDesktop%2Fb%2Findex.html%22%2C%22url_path%22%3A%22%2FC%3A%2FUsers%2Fthink%2FDesktop%2Fb%2Findex.html%22%2C%22referrer_host%22%3A%22%22%2C%22referrer%22%3A%22%22%2C%22x%22%3A46%2C%22y%22%3A411%7D%7D"})}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page"},[i("div",{staticStyle:{margin:"20px 10px"}},[i("input",{attrs:{type:"file",multiple:"false",id:"sheetjs-input",accept:".xlsx,.xls"},on:{change:function(t){e.onchange(t)}}}),e._v(" "),i("span",{staticStyle:{color:"#ff0000"}},[e._v("导入的excel文件命名格式必须是：项目名称_时间 比如: demo_2019-1-1 或 demo_2019-01-01")]),e._v(" "),e.isUp?i("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出EXCEL")]):i("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出EXCEL模板")])]),e._v(" "),i("div",{staticStyle:{"margin-left":"10px","margin-bottom":"20px",display:"inline-block",border:"1px solid rgb(204, 204, 204)",padding:"20px","border-radius":"4px","line-height":"1.4",color:"#333"}},[i("p",{ref:"info1"},[e._v("项目："+e._s(e.fileName.split("_")[0])+"     工期："+e._s(e.info.total)+"天/人\n            "),e.info.delay?i("span",[e._v("(原评估"+e._s(100*(e.info.total-e.info.delay)/100)+"天/人)")]):e._e(),e._v("     开发周期："+e._s(e.timelines.length)+"天")]),e._v(" "),i("p",{ref:"info2"},[e._v("开始日期："+e._s(e.timelines.length?e.timelines[0].date:"")+"     结束日期："+e._s(e.endDate.date)+"\n            "),e.planTimeLines.length&&e.endDate.time!=e.planTimeLines[e.planTimeLines.length-1].time?i("span",[e._v("（原计划"+e._s(e.planTimeLines[e.planTimeLines.length-1].date)+"结束）")]):e._e(),e._v(" "),e.curTimelines.length&&e.endDate.time!=e.curTimelines[e.curTimelines.length-1].time?i("span",[e._v("     次日日期结算进度结束日期："+e._s(e.curTimelines[e.curTimelines.length-1].date))]):e._e()]),e._v(" "),i("p",{ref:"info3"},[e._v("人员信息：\n            "),i("span",{domProps:{innerHTML:e._s(e.info.devs)}})])]),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.table,border:"",height:"480","cell-style":e.getCellStyle}},[e._l(e.fields,function(e,t){return i("el-table-column",{key:e+t,attrs:{"show-overflow-tooltip":"",fixed:"","header-align":"center",prop:e,label:e}})}),e._v(" "),e._l(e.timelines,function(t,r){return i("el-table-column",{key:r,attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center","class-name":1==t.mark?"gray":"",label:t.date,width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(5==t.row.timelines[r]?"休息":"")+"\n            ")]}}])})})],2),e._v(" "),i("div",{staticStyle:{height:"20px","background-color":"#000"}}),e._v(" "),e._l(e.remarks,function(t,r){return i("p",{key:r,staticStyle:{color:"#333"}},[e._v(e._s(t))])})],2)},staticRenderFns:[]};var f=i("VU/8")(o,h,!1,function(e){i("0gg5")},"data-v-4a554e36",null);t.default=f.exports}});