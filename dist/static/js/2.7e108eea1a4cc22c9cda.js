webpackJsonp([2],{"3FrN":function(e,t){},wDQo:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),l=a.n(r),o=window.XLSX,s={name:"Home",data:function(){return{developers:{},colors:["#7A24A6","#001E64","#0070C6","#00B2F6","#00B441","#7ED432","#FEFF00","#FFBE00","#FF0000","#D20000"],dateAr:[],tableData:[{color:"#7A24A6",dateAr:[],devlog:[],max:3,min:0,"自定义一级页面":"首页","自定义二级页面":"","自定义三级页面":"banner","延期天数":"","开发人员":"路人甲","开发记录":"","评估天数":"2.5","进度":""},{color:"#001E64",dateAr:[],devlog:[],max:2,min:0,"自定义一级页面":"新闻","自定义二级页面":"新闻列表","自定义三级页面":"","延期天数":"","开发人员":"路人乙","开发记录":"","评估天数":"1.5","进度":""},{color:"#001E64",dateAr:[],devlog:[],max:2,min:0,"自定义一级页面":"","自定义二级页面":"","自定义三级页面":"新闻详情","延期天数":"","开发人员":"路人甲","开发记录":"","评估天数":"1.5","进度":""}],xlsxData:[],xlsxFields:["自定义一级页面","自定义二级页面","自定义三级页面","开发人员","评估天数","延期天数","开发记录","进度"],fileName:"",suffix:"xlsx",startTime:"",remarks:["黑色条是一个分界线，每天站会纪要问题可以写在黑色条下面，方便项目跟踪","自定义的东西可以随便添加N个","但是自定义后面的[开发人员,评估天数,延期天数,开发记录,进度]不能变，固定内容"],dever:"开发人员",devlogDays:[],finishDateAr:[]}},computed:{developersList:function(){var e=[];for(var t in this.developers)t!=this.dever&&e.push(t);return e},developersDays:function(){var e={time:0,delayTime:0};for(var t in this.developers)t!=this.dever&&(e.time+=parseInt(10*this.developers[t].time),e.delayTime+=parseInt(10*this.developers[t].delayTime));return e},devDays:function(){var e=1e7,t=0;for(var a in this.developers)a!=this.dever&&(e=Math.min(this.developers[a].time,e),t=Math.max(this.developers[a].time,t));return{max:t,min:1e7==e?0:e}}},methods:{colorRgb:function(e,t){var a=e.toLowerCase();if(a&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)){if(4===a.length){for(var r="#",l=1;l<4;l+=1)r+=a.slice(l,l+1).concat(a.slice(l,l+1));a=r}for(var o=[],s=1;s<7;s+=2)o.push(parseInt("0x"+a.slice(s,s+2)));a="rgba("+o.join(",")+","+(void 0!=t?t:.3)+")"}var i=a.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),n=parseFloat(i[3]||1),d=Math.floor(n*parseInt(i[0])+255*(1-n)),h=Math.floor(n*parseInt(i[1])+255*(1-n)),v=Math.floor(n*parseInt(i[2])+255*(1-n));return"#"+("0"+d.toString(16)).slice(-2)+("0"+h.toString(16)).slice(-2)+("0"+v.toString(16)).slice(-2)},getCellStyle:function(e){var t="";if(e.columnIndex>this.xlsxFields.length-1&&""!=e.row[this.dever]){var a=e.row.dateAr[e.columnIndex-this.xlsxFields.length];t=2==a?"background-color:"+e.row.color:3==a?"background-color:"+this.colorRgb(e.row.color):4==a?"background-color:"+this.colorRgb(e.row.color,.7):""}return t},getTotalTime:function(e,t,a){for(var r=0,l=0,o=[];r<Math.ceil(e);){var s=new Date(Date.parse(void 0!=a?a:this.startTime)+864e5*l);0!=s.getDay()&&6!=s.getDay()&&r++,l++;var i={date:s.format("MM月dd日"),weekend:0!=s.getDay()&&6!=s.getDay()?0:1};o.push(i)}for(;l<=t;){var n=new Date(Date.parse(void 0!=a?a:this.startTime)+864e5*l),d={date:n.format("MM月dd日"),weekend:0!=n.getDay()&&6!=n.getDay()?0:1};o.push(d),l++}return o},onchange:function(e){var t=this,a=e.target.files;if(a&&0!=a.length){var r=a[0];t.fileName=r.name.replace("."+t.suffix,"").split(" ")[0],t.startTime=t.fileName.split("_")[1].replace(/\-/g,"/"),console.log(t.startTime);var l=new FileReader;l.onload=function(e){for(var a="",r=new Uint8Array(e.target.result),l=r.byteLength,s=0;s<l;s++)a+=String.fromCharCode(r[s]);var i=o.read(a,{type:"binary"}),n=i.SheetNames[0],d=i.Sheets[n];console.log(d);for(var h,v=o.utils.sheet_to_json(d,{header:1}),f=v.length,g=0;g<v.length;g++)if(""===v[g].join("").toString().trim()){f=g;break}h=v.splice(0,f);for(var c=[],p=0;p<v.length;p++){var m=v[p].join("").toString().trim();""!==m&&c.push(m)}if(t.remarks=c,t.xlsxData=h,h.length){for(var u=[],y=0;y<h[0].length;y++){if("进度"==h[0][y]){u.push(h[0][y]);break}u.push(h[0][y])}t.xlsxFields=u;for(var D=[],b=1;b<h.length;b++){for(var x={},A=0;A<u.length;A++)A<h[b].length?x[u[A]]=h[b][A]||"":x[u[A]]="";D.push(x)}t.developers={};for(var _=0;_<D.length;_++){var w=t.developers[D[_][t.dever]||t.dever]||{};w.time=w.time||0,w.delayTime=w.delayTime||0,D[_].min=parseInt(w.time),D[_].devlog=D[_].devlog||[];var C=D[_].开发记录.trim(),S=[];C&&""!=D[_][t.dever].trim()?(S=(S=C.split("#")).splice(1,S.length),D[_].devlog=D[_].devlog.concat(S),t.devlogDays=t.devlogDays.concat(S),D[_].延期天数=S.length>Math.ceil(parseFloat(D[_].评估天数||0))?S.length-parseFloat(D[_].评估天数||0):""):D[_].延期天数="",w.delayTime+=parseFloat(D[_].延期天数||0),w.time+=parseFloat(D[_].评估天数||0)+parseFloat(D[_].延期天数||0),D[_].max=Math.ceil(w.time),t.developers[D[_][t.dever]||t.dever]=w}var k=0,F=0;for(var T in t.developers)k=Math.max(t.developers[T].time,k),t.developers[T].color=t.colors[Math.floor(F%t.colors.length)],F++;var M=0;if(t.devlogDays.length){for(var E=0,N=0;N<t.devlogDays.length;N++)E=Math.max(Date.parse(t.devlogDays[N])||0,E);M=Math.abs(Date.parse(t.startTime)-E)/864e5}t.dateAr=t.getTotalTime(k,M);for(var L=0;L<D.length;L++){D[L].dateAr=[];var O=0;D[L].color=t.developers[D[L][t.dever]||t.dever].color;for(var R=0;R<t.dateAr.length;R++){O>=D[L].min&&O<D[L].max&&1!=t.dateAr[R].weekend?D[L].dateAr.push(2):1==t.dateAr[R].weekend?D[L].dateAr.push(1):D[L].dateAr.push(0),1!=t.dateAr[R].weekend&&O++;for(var B=0;B<D[L].devlog.length;B++)if(Date.parse(D[L].devlog[B])==Date.parse(t.startTime)+864e5*R){D[L].dateAr[D[L].dateAr.length-1]=2==D[L].dateAr[D[L].dateAr.length-1]?4:3;break}}}for(var I=0;I<D.length;I++){var j=t.developers[D[I][t.dever]||t.dever];if(j.剩余天数=j.剩余天数||0,100!=D[I].进度&&(D[I].延期天数||0)>0)j.剩余天数+=1;else{for(var U=0,X=0;X<D[I].devlog.length;X++){for(var $=0,H=0;H<t.devlogDays.length;H++)Date.parse(D[I].devlog[X])==Date.parse(t.devlogDays[H])&&$++;$>0&&(U+=Math.floor(1e3/$))}j.剩余天数+=100!=D[I].进度?(D[I].评估天数||0)-U/1e3:0}}var J=0;for(var P in t.developers)J=Math.max(t.developers[P].剩余天数,J);for(var Q=(new Date).format("yyyy/MM/dd"),V=1,q=0;q<t.devlogDays.length;q++)if(Date.parse(Q)==Date.parse(t.devlogDays[q])){V=0;break}var z=new Date(Date.parse(Q)+864e5*V).format("yyyy/MM/dd");t.finishDateAr=t.getTotalTime(Math.ceil(J),0,z),console.log(h),t.tableData=D}},l.readAsArrayBuffer(r)}},sheetStyle:function(e,t){var a={v:e=e.toString(),t:isNaN(Number(e))||""===e.trim()?-1!=e.indexOf("月")&&-1!=e.indexOf("日")&&e.length==e.indexOf("日")+1?"n":"s":"n"};return t&&(a.s={fill:{fgColor:{rgb:t.replace("#","")}}}),a},saveAs:function(e){var t=document.createElement("a");t.download=this.fileName+"."+this.suffix,"msSaveOrOpenBlob"in navigator?window.navigator.msSaveOrOpenBlob(e,t.download):t.href=URL.createObjectURL(e),t.click(),setTimeout(function(){URL.revokeObjectURL(e)},100)},downloadExl:function(){for(var e=[],t=this.xlsxFields.map(function(e){return{name:e,value:0}}).concat(this.dateAr.map(function(e){return{name:e.date,value:e.weekend}})),a={},r="A1",s=0;s<t.length;s++){var i=s>25?this.getCharCol(s):String.fromCharCode(65+s);a[i+1]=this.sheetStyle(t[s].name,1==t[s].value?"#CCCCCC":""),a[i+(this.tableData.length+2)]=this.sheetStyle("","#000000"),r=i+(this.tableData.length+2);for(var n=0;n<this.remarks.length;n++)a[i+(this.tableData.length+3+n)]=this.sheetStyle(0==s?this.remarks[n].trim():""),r=i+(this.tableData.length+3+n),0==s&&e.push({s:{c:0,r:this.tableData.length+3+n-1},e:{c:this.xlsxFields.length-1,r:this.tableData.length+3+n-1}})}for(var d=0;d<this.tableData.length;d++)for(var h=0;h<t.length;h++){var v=h>25?this.getCharCol(h):String.fromCharCode(65+h);if(h<this.xlsxFields.length)a[v+(d+2)]=this.sheetStyle(this.tableData[d][this.xlsxFields[h]]);else{var f=this.tableData[d].dateAr[h-this.xlsxFields.length],g="";g=""!=this.tableData[d][this.dever]&&2==f?this.tableData[d].color:1==f?"#CCCCCC":3==f?this.colorRgb(this.tableData[d].color):4==f?this.colorRgb(this.tableData[d].color,.7):"",a[v+(d+2)]=this.sheetStyle("",g)}}a["!merges"]=e;var c={SheetNames:["排期"],Sheets:{"排期":l()({},a,{"!ref":"A1:"+r})}};console.log(c);var p=new Blob([this.s2ab(o.write(c,{bookType:this.suffix,bookSST:!1,type:"binary"}))],{type:""});this.saveAs(p)},getCharCol:function(e){for(var t="",a=0;e>0;)a=e%26+1,t=String.fromCharCode(a+64)+t,e=(e-a)/26;return t},s2ab:function(e){if("undefined"!=typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=0;r!=e.length;++r)a[r]=255&e.charCodeAt(r);return t}for(var l=new Array(e.length),o=0;o!=e.length;++o)l[o]=255&e.charCodeAt(o);return l}},mounted:function(){this.fileName="排期示例_"+(new Date).format(),this.startTime=this.fileName.split("_")[1].replace(/\-/g,"/")}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{staticStyle:{"margin-bottom":"20px"}},[a("input",{attrs:{type:"file",multiple:"false",id:"sheetjs-input",accept:".xlsx,.xls"},on:{change:function(t){e.onchange(t)}}}),e._v(" "),a("span",{staticStyle:{color:"#ff0000"}},[e._v("导入的excel文件命名格式必须是：项目名称_时间 比如: demo_2019-1-1 或 demo_2019-01-01")]),e._v(" "),e.tableData.length?a("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出EXCEL模板")]):a("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出EXCEL")])]),e._v(" "),a("p",[e._v("项目："+e._s(e.fileName.split("_")[0])+"     工作日："+e._s(e.developersDays.time/10)+"天/人\n        "),e.developersDays.delayTime>0?a("span",[e._v("(包括延期"+e._s(e.developersDays.delayTime/10)+"天)")]):e._e(),e._v("     开发(包括周末)："+e._s(e.dateAr.length)+"天/"+e._s(e.developersList.length)+"人")]),e._v(" "),a("p",[e._v("开始日期："+e._s(e.dateAr.length?e.dateAr[0].date:"")+"     结束日期："+e._s(e.dateAr.length?e.dateAr[e.dateAr.length-1].date:"")+"\n        "),e.finishDateAr.length?a("span",[e._v("     当前日期结算进度结束日期："+e._s(e.finishDateAr[e.finishDateAr.length-1].date))]):e._e()]),e._v(" "),a("p",{staticStyle:{"margin-bottom":"20px"}},[e._v("开发人员："+e._s(e.developersList.toString())+"     单人最短："+e._s(e.devDays.min)+"天     单人最长："+e._s(e.devDays.max)+"天")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",height:"480","cell-style":e.getCellStyle}},[e._l(e.xlsxFields,function(e,t){return a("el-table-column",{key:e+t,attrs:{"show-overflow-tooltip":"",fixed:"","header-align":"center",prop:e,label:e}})}),e._v(" "),e._l(e.dateAr,function(e,t){return a("el-table-column",{key:t,attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center","class-name":e.weekend?"gray":"",label:e.date,width:"100"}})})],2),e._v(" "),a("div",{staticStyle:{"background-color":"#000000",height:"20px"}}),e._v(" "),e._l(e.remarks,function(t,r){return a("p",{key:r},[e._v(e._s(t))])})],2)},staticRenderFns:[]};var n=a("VU/8")(s,i,!1,function(e){a("3FrN")},"data-v-1fb467f0",null);t.default=n.exports}});