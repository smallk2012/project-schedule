webpackJsonp([2],{"++pM":function(e,t){},wDQo:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),l=a.n(r),o=window.XLSX,s={name:"Home",data:function(){return{developers:{},colors:["#7A24A6","#001E64","#0070C6","#00B2F6","#00B441","#7ED432","#FEFF00","#FFBE00","#FF0000","#D20000"],dateAr:[],tableData:[],xlsxData:[],xlsxFields:[],fileName:"",suffix:"xlsx",startTime:"",remarks:[],dever:"开发人员",devlogDays:[],finishDateAr:[]}},computed:{developersList:function(){var e=[];for(var t in this.developers)t!=this.dever&&e.push(t);return e},developersDays:function(){var e={time:0,delayTime:0};for(var t in this.developers)t!=this.dever&&(e.time+=parseInt(10*this.developers[t].time),e.delayTime+=parseInt(10*this.developers[t].delayTime));return e},devDays:function(){var e=1e7,t=0;for(var a in this.developers)a!=this.dever&&(e=Math.min(this.developers[a].time,e),t=Math.max(this.developers[a].time,t));return{max:t,min:1e7==e?0:e}}},methods:{colorRgb:function(e,t){var a=e.toLowerCase();if(a&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)){if(4===a.length){for(var r="#",l=1;l<4;l+=1)r+=a.slice(l,l+1).concat(a.slice(l,l+1));a=r}for(var o=[],s=1;s<7;s+=2)o.push(parseInt("0x"+a.slice(s,s+2)));a="rgba("+o.join(",")+","+(void 0!=t?t:.3)+")"}var n=a.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(n[3]||1),d=Math.floor(i*parseInt(n[0])+255*(1-i)),h=Math.floor(i*parseInt(n[1])+255*(1-i)),v=Math.floor(i*parseInt(n[2])+255*(1-i));return"#"+("0"+d.toString(16)).slice(-2)+("0"+h.toString(16)).slice(-2)+("0"+v.toString(16)).slice(-2)},getCellStyle:function(e){var t="";if(e.columnIndex>this.xlsxFields.length-1&&""!=e.row[this.dever]){var a=e.row.dateAr[e.columnIndex-this.xlsxFields.length];t=2==a?"background-color:"+e.row.color:3==a?"background-color:"+this.colorRgb(e.row.color):4==a?"background-color:"+this.colorRgb(e.row.color,.7):""}return t},getTotalTime:function(e,t,a){for(var r=0,l=0,o=[];r<Math.ceil(e);){var s=new Date(Date.parse(void 0!=a?a:this.startTime)+864e5*l);0!=s.getDay()&&6!=s.getDay()&&r++,l++;var n={date:s.format("MM月dd日"),weekend:0!=s.getDay()&&6!=s.getDay()?0:1};o.push(n)}for(;l<=t;){var i=new Date(Date.parse(void 0!=a?a:this.startTime)+864e5*l),d={date:i.format("MM月dd日"),weekend:0!=i.getDay()&&6!=i.getDay()?0:1};o.push(d),l++}return o},onchange:function(e){var t=this,a=e.target.files;if(a&&0!=a.length){var r=a[0];t.fileName=r.name.replace("."+t.suffix,"").split(" ")[0],t.startTime=t.fileName.split("_")[1].replace(/\-/g,"/"),console.log(t.startTime);var l=new FileReader;l.onload=function(e){for(var a="",r=new Uint8Array(e.target.result),l=r.byteLength,s=0;s<l;s++)a+=String.fromCharCode(r[s]);var n=o.read(a,{type:"binary"}),i=n.SheetNames[0],d=n.Sheets[i];console.log(d);for(var h,v=o.utils.sheet_to_json(d,{header:1}),f=v.length,g=0;g<v.length;g++)if(""===v[g].join("").toString().trim()){f=g;break}h=v.splice(0,f);for(var c=[],p=0;p<v.length;p++){var m=v[p].join("").toString().trim();""!==m&&c.push(m)}if(t.remarks=c,t.xlsxData=h,h.length){for(var u=[],y=0;y<h[0].length;y++){if("进度"==h[0][y]){u.push(h[0][y]);break}u.push(h[0][y])}t.xlsxFields=u;for(var D=[],b=1;b<h.length;b++){for(var x={},A=0;A<u.length;A++)A<h[b].length?x[u[A]]=h[b][A]||"":x[u[A]]="";D.push(x)}t.developers={};for(var w=0;w<D.length;w++){var _=t.developers[D[w][t.dever]||t.dever]||{};_.time=_.time||0,_.delayTime=_.delayTime||0,D[w].min=parseInt(_.time),D[w].devlog=D[w].devlog||[];var C=D[w].开发记录.trim(),S=[];C&&""!=D[w][t.dever].trim()?(S=(S=C.split("#")).splice(1,S.length),D[w].devlog=D[w].devlog.concat(S),t.devlogDays=t.devlogDays.concat(S),D[w].延期天数=S.length>Math.ceil(parseFloat(D[w].评估天数||0))?S.length-parseFloat(D[w].评估天数||0):""):D[w].延期天数="",_.delayTime+=parseFloat(D[w].延期天数||0),_.time+=parseFloat(D[w].评估天数||0)+parseFloat(D[w].延期天数||0),D[w].max=Math.ceil(_.time),t.developers[D[w][t.dever]||t.dever]=_}var k=0,F=0;for(var M in t.developers)k=Math.max(t.developers[M].time,k),t.developers[M].color=t.colors[Math.floor(F%t.colors.length)],F++;var T=0;if(t.devlogDays.length){for(var L=0,O=0;O<t.devlogDays.length;O++)L=Math.max(Date.parse(t.devlogDays[O])||0,L);T=Math.abs(Date.parse(t.startTime)-L)/864e5}t.dateAr=t.getTotalTime(k,T);for(var R=0;R<D.length;R++){D[R].dateAr=[];var N=0;D[R].color=t.developers[D[R][t.dever]||t.dever].color;for(var B=0;B<t.dateAr.length;B++){N>=D[R].min&&N<D[R].max&&1!=t.dateAr[B].weekend?D[R].dateAr.push(2):1==t.dateAr[B].weekend?D[R].dateAr.push(1):D[R].dateAr.push(0),1!=t.dateAr[B].weekend&&N++;for(var I=0;I<D[R].devlog.length;I++)if(Date.parse(D[R].devlog[I])==Date.parse(t.startTime)+864e5*B){D[R].dateAr[D[R].dateAr.length-1]=2==D[R].dateAr[D[R].dateAr.length-1]?4:3;break}}}for(var j=0;j<D.length;j++){var E=t.developers[D[j][t.dever]||t.dever];if(E.剩余天数=E.剩余天数||0,100!=D[j].进度&&(D[j].延期天数||0)>0)E.剩余天数+=1;else{for(var U=0,X=0;X<D[j].devlog.length;X++){for(var $=0,H=0;H<t.devlogDays.length;H++)Date.parse(D[j].devlog[X])==Date.parse(t.devlogDays[H])&&$++;$>0&&(U+=Math.floor(1e3/$))}E.剩余天数+=100!=D[j].进度?(D[j].评估天数||0)-U/1e3:0}}var J=0;for(var P in t.developers)J=Math.max(t.developers[P].剩余天数,J);for(var Q=(new Date).format("yyyy/MM/dd"),V=1,q=0;q<t.devlogDays.length;q++)if(Date.parse(Q)==Date.parse(t.devlogDays[q])){V=0;break}var z=new Date(Date.parse(Q)+864e5*V).format("yyyy/MM/dd");t.finishDateAr=t.getTotalTime(Math.ceil(J),0,z),console.log(D),t.tableData=D}},l.readAsArrayBuffer(r)}},sheetStyle:function(e,t){var a={v:e=e.toString(),t:isNaN(Number(e))||""===e.trim()?-1!=e.indexOf("月")&&-1!=e.indexOf("日")&&e.length==e.indexOf("日")+1?"n":"s":"n"};return t&&(a.s={fill:{fgColor:{rgb:t.replace("#","")}}}),a},saveAs:function(e){var t=document.createElement("a");t.download=this.fileName+"."+this.suffix,"msSaveOrOpenBlob"in navigator?window.navigator.msSaveOrOpenBlob(e,t.download):t.href=URL.createObjectURL(e),t.click(),setTimeout(function(){URL.revokeObjectURL(e)},100)},downloadExl:function(){for(var e=[],t=this.xlsxFields.map(function(e){return{name:e,value:0}}).concat(this.dateAr.map(function(e){return{name:e.date,value:e.weekend}})),a={},r="A1",s=0;s<t.length;s++){var n=s>25?this.getCharCol(s):String.fromCharCode(65+s);a[n+1]=this.sheetStyle(t[s].name,1==t[s].value?"#CCCCCC":""),a[n+(this.tableData.length+2)]=this.sheetStyle("","#000000"),r=n+(this.tableData.length+2);for(var i=0;i<this.remarks.length;i++)a[n+(this.tableData.length+3+i)]=this.sheetStyle(0==s?this.remarks[i].trim():""),r=n+(this.tableData.length+3+i),0==s&&e.push({s:{c:0,r:this.tableData.length+3+i-1},e:{c:this.xlsxFields.length-1,r:this.tableData.length+3+i-1}})}for(var d=0;d<this.tableData.length;d++)for(var h=0;h<t.length;h++){var v=h>25?this.getCharCol(h):String.fromCharCode(65+h);if(h<this.xlsxFields.length)a[v+(d+2)]=this.sheetStyle(this.tableData[d][this.xlsxFields[h]]);else{var f=this.tableData[d].dateAr[h-this.xlsxFields.length],g="";g=""!=this.tableData[d][this.dever]&&2==f?this.tableData[d].color:1==f?"#CCCCCC":3==f?this.colorRgb(this.tableData[d].color):4==f?this.colorRgb(this.tableData[d].color,.7):"",a[v+(d+2)]=this.sheetStyle("",g)}}a["!merges"]=e;var c={SheetNames:["排期"],Sheets:{"排期":l()({},a,{"!ref":"A1:"+r})}};console.log(c);var p=new Blob([this.s2ab(o.write(c,{bookType:this.suffix,bookSST:!1,type:"binary"}))],{type:""});this.saveAs(p)},getCharCol:function(e){for(var t="",a=0;e>0;)a=e%26+1,t=String.fromCharCode(a+64)+t,e=(e-a)/26;return t},s2ab:function(e){if("undefined"!=typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=0;r!=e.length;++r)a[r]=255&e.charCodeAt(r);return t}for(var l=new Array(e.length),o=0;o!=e.length;++o)l[o]=255&e.charCodeAt(o);return l}},mounted:function(){}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{staticStyle:{"margin-bottom":"20px"}},[a("input",{attrs:{type:"file",multiple:"false",id:"sheetjs-input",accept:".xlsx,.xls"},on:{change:function(t){e.onchange(t)}}}),e._v(" "),e.tableData.length?a("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出XLSX")]):e._e()]),e._v(" "),a("p",[e._v("项目："+e._s(e.fileName.split("_")[0])+"     工作日："+e._s(e.developersDays.time/10)+"天/人\n        "),e.developersDays.delayTime>0?a("span",[e._v("(包括延期"+e._s(e.developersDays.delayTime/10)+"天)")]):e._e(),e._v("     开发(包括周末)："+e._s(e.dateAr.length)+"天/"+e._s(e.developersList.length)+"人")]),e._v(" "),a("p",[e._v("开始日期："+e._s(e.dateAr.length?e.dateAr[0].date:"")+"     结束日期："+e._s(e.dateAr.length?e.dateAr[e.dateAr.length-1].date:"")+"\n        "),e.finishDateAr.length?a("span",[e._v("     当前日期结算进度结束日期："+e._s(e.finishDateAr[e.finishDateAr.length-1].date))]):e._e()]),e._v(" "),a("p",{staticStyle:{"margin-bottom":"20px"}},[e._v("开发人员："+e._s(e.developersList.toString())+"     单人最短："+e._s(e.devDays.min)+"天     单人最长："+e._s(e.devDays.max)+"天")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",height:"480","cell-style":e.getCellStyle}},[e._l(e.xlsxFields,function(e,t){return a("el-table-column",{key:e+t,attrs:{"show-overflow-tooltip":"",fixed:"","header-align":"center",prop:e,label:e}})}),e._v(" "),e._l(e.dateAr,function(e,t){return a("el-table-column",{key:t,attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center","class-name":e.weekend?"gray":"",label:e.date,width:"100"}})})],2),e._v(" "),e._l(e.remarks,function(t,r){return a("p",{key:r},[e._v(e._s(t))])})],2)},staticRenderFns:[]};var i=a("VU/8")(s,n,!1,function(e){a("++pM")},"data-v-0f1671ba",null);t.default=i.exports}});