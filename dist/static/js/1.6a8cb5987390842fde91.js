webpackJsonp([1],{"4cOk":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("woOf"),l=r.n(i),n=r("mvHQ"),a=r.n(n),o=window.XLSX,s={name:"Excel",data:function(){return{isUp:!1,colors:["#7A24A6","#001E64","#0070C6","#00B2F6","#00B441","#7ED432","#FEFF00","#FFBE00","#FF0000","#D20000"],suffix:"xlsx",fileName:"",startTime:"",remarks:[],fields:[],timelines:[],curTimelines:[],table:[],devInfo:{}}},computed:{info:function(){var e=0,t=0,r=[];for(var i in this.devInfo)e+=this.devInfo[i].开发总天数||0,t+=this.devInfo[i].延期总天数||0,r.push(i+'<span style="color:#ff0000;">'+this.devInfo[i].开发总天数+"天</span>");return{total:e,delay:t,devs:r.toString()}}},methods:{getTimeLines:function(e,t,r){for(var i=[],l=0,n=0;n<Math.ceil(e)||l<=t;){var a=new Date(Date.parse(r)+864e5*l),o=0!=a.getDay()&&6!=a.getDay(),s={date:a.format("MM月dd日"),mark:o?0:1,time:a.getTime()};i.push(s),l++,o&&n<Math.ceil(e)&&n++}return i},colorRgb:function(e,t){var r=e.toLowerCase();if(r&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(r)){if(4===r.length){for(var i="#",l=1;l<4;l+=1)i+=r.slice(l,l+1).concat(r.slice(l,l+1));r=i}for(var n=[],a=1;a<7;a+=2)n.push(parseInt("0x"+r.slice(a,a+2)));r="rgba("+n.join(",")+","+(void 0!=t?t:.3)+")"}var o=r.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),s=parseFloat(o[3]||1),h=Math.floor(s*parseInt(o[0])+255*(1-s)),f=Math.floor(s*parseInt(o[1])+255*(1-s)),g=Math.floor(s*parseInt(o[2])+255*(1-s));return"#"+("0"+h.toString(16)).slice(-2)+("0"+f.toString(16)).slice(-2)+("0"+g.toString(16)).slice(-2)},getCellStyle:function(e){var t="";if(e.columnIndex>this.fields.length-1&&""!=e.row.开发人员){var r=e.row.timelines[e.columnIndex-this.fields.length];t=2==r?"background-color:"+e.row.color:3==r?"background-color:"+this.colorRgb(e.row.color):4==r?"background-color:"+this.colorRgb(e.row.color,.7):5==r?"color:#FF0000;":""}return t},sheetFmt:function(e){if(e.length){for(var t=[],r=0;r<e[0].length&&(t.push(e[0][r]),"进度"!=e[0][r]);r++);this.fields=t;for(var i=[],l=e.length,n=0;n<e.length;n++){if(""===e[n].join("").toString().trim()){l=n+1;break}i.push(e[n])}for(var a=[],o=l;o<e.length;o++){if(""===e[o].join("").toString().trim()){l=o+1;break}a.push(e[o].join("").toString().trim())}this.remarks=a;for(var s=[],h=1;h<i.length;h++){for(var f={},g=0;g<i[h].length;g++)g<this.fields.length&&(f[this.fields[g]]=i[h][g]||"");s.push(f)}for(var c={},v=0;v<s.length;v++){var m=c[s[v].开发人员||"开发人员"]||{};m.开发记录=(m.开发记录||"")+s[v].开发记录,m.休假记录=(m.休假记录||"")+s[v].休假记录,c[s[v].开发人员||"开发人员"]=m}var d=0;for(var p in c){c[p].color=this.colors[Math.floor(d%this.colors.length)],d++;var u=c[p].开发记录.split("#");u=u.splice(1,u.length),c[p].devlog=[];for(var b=0;b<u.length;b++)c[p].devlog.push(Date.parse(u[b]))}for(var y=0;y<s.length;y++){var _=s[y].开发记录.split("#");_=_.splice(1,_.length),s[y].devlog=[];for(var x=0,S=0;S<_.length;S++){var C=0,k=Date.parse(_[S]);s[y].devlog.push(k);for(var w=0;w<c[s[y].开发人员||"开发人员"].devlog.length;w++)k==c[s[y].开发人员||"开发人员"].devlog[w]&&C++;C>0&&(x+=Math.floor(100/C))}var T=100*parseFloat(s[y].评估天数||0);s[y].延期天数=x>T?(x-T)/100:""}for(var F=0;F<s.length;F++){var A=c[s[F].开发人员||"开发人员"]||{};s[F].color=A.color,A.开发总天数=parseFloat(A.开发总天数||0),A.延期总天数=parseFloat(A.延期总天数||0),s[F].min=parseInt(A.开发总天数),A.开发总天数+=parseFloat(s[F].评估天数||0)+parseFloat(s[F].延期天数||0),A.延期总天数+=parseFloat(s[F].延期天数||0),s[F].max=Math.ceil(A.开发总天数),c[s[F].开发人员||"开发人员"]=A}for(var M in c){var D=c[M].休假记录.split("#");D=D.splice(1,D.length);for(var E=[],N=0;N<D.length;N++)if(0==N)E.push(Date.parse(D[N]));else{for(var I=0,L=0;L<E.length;L++)if(E[N]==D[L]){I++;break}0==I&&E.push(Date.parse(D[N]))}c[M].happyTime=E}var O=0,U=0;for(var R in c){O=Math.max(O,c[R].开发总天数+c[R].happyTime.length);for(var j=0;j<c[R].devlog.length;j++)U=Math.max(U,c[R].devlog[j])}for(var B=(U-Date.parse(this.startTime))/864e5,$=this.getTimeLines(O,B,this.startTime),X=0;X<s.length;X++){s[X].timelines=[];for(var z=0,H=0;H<$.length;H++){var P=0;if(z>=s[X].min&&z<s[X].max&&1!=$[H].mark){for(var J=c[s[X].开发人员||"开发人员"].happyTime,Q=0;Q<J.length;Q++)$[H].time==J[Q]&&P++;P>0?s[X].timelines.push(5):s[X].timelines.push(2)}else 1==$[H].mark?s[X].timelines.push(1):s[X].timelines.push(0);1!=$[H].mark&&0==P&&z++;for(var V=0;V<s[X].devlog.length;V++)if(s[X].devlog[V]==$[H].time){s[X].timelines[s[X].timelines.length-1]=2==s[X].timelines[s[X].timelines.length-1]?4:3;break}}}for(var q=0;q<s.length;q++){var G=c[s[q].开发人员||"开发人员"];if(G.剩余天数=G.剩余天数||0,100!=s[q].进度)if((s[q].延期天数||0)>0)G.剩余天数+=1;else{for(var K=0,W=0;W<s[q].devlog.length;W++){for(var Y=0,Z=0;Z<G.devlog.length;Z++)s[q].devlog[W]==G.devlog[Z]&&Y++;Y>0&&(K+=Math.floor(1e3/Y))}G.剩余天数+=100!=s[q].进度?(s[q].评估天数||0)-K/1e3:0}}var ee=0,te=(new Date).format("yyyy/MM/dd"),re=Date.parse(te);for(var ie in c){for(var le=0,ne=0;ne<c[ie].happyTime.length;ne++)c[ie].happyTime[ne]>=re&&le++;for(var ae=1,oe=0;oe<c[ie].devlog.length;oe++)if(c[ie].devlog[oe]==re){ae=0;break}ee=Math.max(c[ie].剩余天数+le+ae,ee)}var se=this.getTimeLines(ee,0,te);this.devInfo=c,this.curTimelines=se,this.timelines=$,this.table=s,console.log(s),console.log(se)}},onchange:function(e){var t=this,r=e.target.files;if(r&&0!=r.length){t.isUp=!0;var i=r[0];t.fileName=i.name.replace("."+t.suffix,"").split(" ")[0],t.startTime=t.fileName.split("_")[1].replace(/\-/g,"/"),console.log(t.startTime);var l=new FileReader;l.onload=function(e){for(var r="",i=new Uint8Array(e.target.result),l=i.byteLength,n=0;n<l;n++)r+=String.fromCharCode(i[n]);var s=o.read(r,{type:"binary"}),h=s.SheetNames[0],f=s.Sheets[h],g=o.utils.sheet_to_json(f,{header:1});console.log(a()(g).replace(/\"/g,"'")),t.sheetFmt(g)},l.readAsArrayBuffer(i)}},getCharCol:function(e){for(var t="",r=0;e>0;)r=e%26+1,t=String.fromCharCode(r+64)+t,e=(e-r)/26;return t},s2ab:function(e){if("undefined"!=typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),i=0;i!=e.length;++i)r[i]=255&e.charCodeAt(i);return t}for(var l=new Array(e.length),n=0;n!=e.length;++n)l[n]=255&e.charCodeAt(n);return l},sheetStyle:function(e,t,r){var i={v:e=r||e.toString(),t:isNaN(Number(e))||""===e.trim()?-1!=e.indexOf("月")&&-1!=e.indexOf("日")&&e.length==e.indexOf("日")+1?"n":"s":"n"};return t&&(i.s={fill:{fgColor:{rgb:t.replace("#","")}}}),r&&(i.s=i.s||{},i.s.font={sz:12,bold:!1,color:{rgb:"FF0000"}},i.s.alignment={vertical:"center",horizontal:"center"}),i},saveAs:function(e){var t=document.createElement("a");t.download=this.fileName+"."+this.suffix,"msSaveOrOpenBlob"in navigator?window.navigator.msSaveOrOpenBlob(e,t.download):t.href=URL.createObjectURL(e),t.click(),setTimeout(function(){URL.revokeObjectURL(e)},100)},downloadExl:function(){for(var e=[],t=this.fields.map(function(e){return{name:e,value:0}}).concat(this.isUp?this.timelines.map(function(e){return{name:e.date,value:e.mark}}):[]),r={},i="A1",n=0;n<t.length;n++){var a=n>25?this.getCharCol(n):String.fromCharCode(65+n);r[a+1]=this.sheetStyle(t[n].name,1==t[n].value?"#CCCCCC":""),r[a+(this.table.length+2)]=this.sheetStyle("","#000000"),i=a+(this.table.length+2);for(var s=0;s<this.remarks.length;s++)r[a+(this.table.length+3+s)]=this.sheetStyle(0==n?this.remarks[s].trim():""),i=a+(this.table.length+3+s),0==n&&e.push({s:{c:0,r:this.table.length+3+s-1},e:{c:this.fields.length-1,r:this.table.length+3+s-1}})}for(var h=0;h<this.table.length;h++)for(var f=0;f<t.length;f++){var g=f>25?this.getCharCol(f):String.fromCharCode(65+f);if(f<this.fields.length)r[g+(h+2)]=this.sheetStyle(this.table[h][this.fields[f]]);else{var c=this.table[h].timelines[f-this.fields.length],v="",m="";""!=this.table[h].开发人员&&2==c?v=this.table[h].color:1==c?v="#CCCCCC":3==c?v=this.colorRgb(this.table[h].color):4==c?v=this.colorRgb(this.table[h].color,.7):5==c?m="休息":v="",r[g+(h+2)]=this.sheetStyle("",v,m)}}r["!merges"]=e;var d={SheetNames:["排期"],Sheets:{"排期":l()({},r,{"!ref":"A1:"+i})}};this.isUp&&(d.SheetNames.push("项目信息"),d.Sheets.项目信息={"!ref":"A1:A3",A1:{v:this.$refs.info1.innerText,t:"s"},A2:{v:this.$refs.info2.innerText,t:"s"},A3:{v:this.$refs.info3.innerText,t:"s"}}),console.log(d);var p=new Blob([this.s2ab(o.write(d,{bookType:this.suffix,bookSST:!1,type:"binary"}))],{type:""});this.saveAs(p)}},mounted:function(){this.fileName="排期示例_"+(new Date).format(),this.startTime=this.fileName.split("_")[1].replace(/\-/g,"/");this.sheetFmt([["自定义一级页面","自定义二级页面","自定义三级页面","开发人员","评估天数","休假记录","延期天数","开发记录","进度"],["首页","","banner","路人甲","2.5","","","",""],["新闻","新闻列表","","路人乙","1.5","","","",""],["","","新闻详情","路人甲","1.5","","","",""],["","","","","","","","",""],["黑色条是一个分界线，每天站会纪要问题可以写在黑色条下面，方便项目跟踪","","","","","","","",""],["自定义的东西可以随便添加N个","","","","","","","",""],["休假记录和开发记录的日期必须#符号开头，如#2019/1/1或#2019/01/01","","","","","","","",""],["但是自定义后面的[开发人员,评估天数,休假记录,延期天数,开发记录,进度]为固定内容","","","","","","","",""],["休假记录：把你休息的那天日期记录起来，就不会排期了","","","","","","","",""],["延期天数：导入到网站保存的时候，会自动结算","","","","","","","",""],["干活前：你只需要弄自定义页面，开发人员，评估天数","","","","","","","",""],["干活后：你只需要填开发记录，进度","","","","","","","",""]])}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page"},[r("div",{staticStyle:{margin:"20px 10px"}},[r("input",{attrs:{type:"file",multiple:"false",id:"sheetjs-input",accept:".xlsx,.xls"},on:{change:function(t){e.onchange(t)}}}),e._v(" "),r("span",{staticStyle:{color:"#ff0000"}},[e._v("导入的excel文件命名格式必须是：项目名称_时间 比如: demo_2019-1-1 或 demo_2019-01-01")]),e._v(" "),e.isUp?r("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出EXCEL")]):r("button",{attrs:{type:"button"},on:{click:e.downloadExl}},[e._v("导出EXCEL模板")])]),e._v(" "),r("div",{staticStyle:{"margin-left":"10px","margin-bottom":"20px",display:"inline-block",border:"1px solid rgb(204, 204, 204)",padding:"20px","border-radius":"4px","line-height":"1.4",color:"#333"}},[r("p",{ref:"info1"},[e._v("项目："+e._s(e.fileName.split("_")[0])+"     工作日："+e._s(e.info.total)+"天/人\n            "),e.info.delay?r("span",[e._v("(包括延期天数"+e._s(e.info.delay)+"天)")]):e._e(),e._v("     开发周期："+e._s(e.timelines.length)+"天")]),e._v(" "),r("p",{ref:"info2"},[e._v("开始日期："+e._s(e.timelines.length?e.timelines[0].date:"")+"     结束日期："+e._s(e.timelines.length?e.timelines[e.timelines.length-1].date:"")+"\n            "),r("span",[e._v("     当前日期结算进度结束日期："+e._s(e.curTimelines.length?e.curTimelines[e.curTimelines.length-1].date:""))])]),e._v(" "),r("p",{ref:"info3"},[e._v("人员信息：\n            "),r("span",{domProps:{innerHTML:e._s(e.info.devs)}})])]),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.table,border:"",height:"480","cell-style":e.getCellStyle}},[e._l(e.fields,function(e,t){return r("el-table-column",{key:e+t,attrs:{"show-overflow-tooltip":"",fixed:"","header-align":"center",prop:e,label:e}})}),e._v(" "),e._l(e.timelines,function(t,i){return r("el-table-column",{key:i,attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center","class-name":1==t.mark?"gray":"",label:t.date,width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(5==t.row.timelines[i]?"休息":"")+"\n            ")]}}])})})],2),e._v(" "),r("div",{staticStyle:{height:"20px","background-color":"#000"}}),e._v(" "),e._l(e.remarks,function(t,i){return r("p",{key:i,staticStyle:{color:"#333"}},[e._v(e._s(t))])})],2)},staticRenderFns:[]};var f=r("VU/8")(s,h,!1,function(e){r("E3Dk")},"data-v-40c7ec86",null);t.default=f.exports},E3Dk:function(e,t){}});